<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="icon" href="img/logo.png" type="image/png">
  <link
    rel="stylesheet"
    href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css"
  />
  <link rel="stylesheet" href="css/applications.css" />

  <style>
    .container { padding: 20px; max-width: 1300px; margin: auto; }
    table { width: 100%; border-collapse: collapse; margin-top: 20px; }
    table th, table td { border: 1px solid #ddd; padding: 4px; font-size: 10px; }
    table th { background-color: #f2f2f2; }
    .btn { padding: 6px 10px; border: none; cursor: pointer; color: white; }
    .accept { background: green; }
    .waiting { background: #de7a23; }
    .reject { background: red; }
  </style>

  <title>Test Mode</title>
</head>
<body>

<div class="container">

  <table id="applicationsTable">
    <thead>
      <tr>
        <th>Name</th><th>Email</th><th>Phone</th><th>Faculty</th>
        <th>Level</th><th>Strengths</th><th>Weaknesses</th>
        <th>Committee</th><th>Status</th><th>Called</th><th>Actions</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>

</div>

<script>
/* -----------------------------
    بيانات تجريبية TEST DATA
------------------------------*/
let applicationsData = [
  {
    id: 1,
    name: "belal",
    email: "belal@example.com",
    phone: "20 01126574986",
    faculty: "Engineering",
    level: "4",
    strengths: "Teamwork",
    weaknesses: "Time Management",
    committee: "Photography",
    status: 0,
    called: 0
  },
  {
    id: 2,
    name: "ahmed",
    email: "ahmed@example.com",
    phone: "20 11 41853770",
    faculty: "Science",
    level: "3",
    strengths: "Creativity",
    weaknesses: "Public Speaking",
    committee: "Photography",
    status: 1,
    called: 1
  }
];

//for Normalize Number 
function formatWhatsAppNumber(phone) {
  phone = phone.replace(/\D/g, "");

  if (phone.startsWith("0")) {
    phone = "20" + phone.substring(1);
  }
 
  else if (!phone.startsWith("20")) {
    phone = "20" + phone; 
  }

  return phone;
}




/* -----------------------------
    عرض الجدول لأول مرة
------------------------------*/
document.addEventListener("DOMContentLoaded", function() {
  renderTable(applicationsData);
});

/* -----------------------------
        عرض كل الصفوف
------------------------------*/
function renderTable(applications) {
  const tableBody = document.querySelector("#applicationsTable tbody");
  tableBody.innerHTML = "";

  applications.forEach((app) => {
    const row = document.createElement("tr");
    row.setAttribute("data-id", app.id);

    row.innerHTML = `
      <td>${app.name}</td>
      <td>${app.email}</td>
      <td>${app.phone}</td>
      <td>${app.faculty}</td>
      <td>${app.level}</td>
      <td>${app.strengths}</td>
      <td>${app.weaknesses}</td>
      <td>${app.committee}</td>
      <td>${getStatusLabel(app.status)}</td>

      <td>
        <i class="fa ${app.called ? 'fa-check-circle text-success' : 'fa-circle text-secondary'}"
           style="cursor:pointer; font-size:18px; margin-right:8px;"
           onclick="changeCalledStatus(${app.id}, 1)"></i>

        <i class="fa ${app.called ? 'fa-circle text-secondary' : 'fa-times-circle text-danger'}"
           style="cursor:pointer; font-size:18px;"
           onclick="changeCalledStatus(${app.id}, 0)"></i>
      </td>

      <td>
        <button class="btn accept" onclick="changeStatus(${app.id}, 1)">Accept</button>
        <button class="btn waiting" onclick="changeStatus(${app.id}, 0)">Waiting</button>
        <button class="btn reject" onclick="changeStatus(${app.id}, 2)">Reject</button>

       <a href="https://wa.me/${formatWhatsAppNumber(app.phone)}" target="_blank" class="btn" style="background-color:#25D366;">WhatsApp</a>

      </td>
    `;

    tableBody.appendChild(row);
  });
}

/* -----------------------------
  تحديث صف واحد فقط بعد التعديل
------------------------------*/
function updateRow(application) {
  const row = document.querySelector(`tr[data-id="${application.id}"]`);
  if (!row) return;

  row.innerHTML = `
    <td>${application.name}</td>
    <td>${application.email}</td>
    <td>${application.phone}</td>
    <td>${application.faculty}</td>
    <td>${application.level}</td>
    <td>${application.strengths}</td>
    <td>${application.weaknesses}</td>
    <td>${application.committee}</td>
    <td>${getStatusLabel(application.status)}</td>

    <td>
      <i class="fa ${application.called ? 'fa-check-circle text-success' : 'fa-circle text-secondary'}"
         style="cursor:pointer; font-size:18px; margin-right:8px;"
         onclick="changeCalledStatus(${application.id}, 1)"></i>

      <i class="fa ${application.called ? 'fa-circle text-secondary' : 'fa-times-circle text-danger'}"
         style="cursor:pointer; font-size:18px;"
         onclick="changeCalledStatus(${application.id}, 0)"></i>
    </td>

    <td>
      <button class="btn accept" onclick="changeStatus(${application.id}, 1)">Accept</button>
      <button class="btn waiting" onclick="changeStatus(${application.id}, 0)">Waiting</button>
      <button class="btn reject" onclick="changeStatus(${application.id}, 2)">Reject</button>
        <a href="https://wa.me/${formatWhatsAppNumber(app.phone)}" 
   target="_blank" 
   class="btn" style="background-color:#25D366;">WhatsApp</a>

    </td>
  `;
}

/* -----------------------------
      دوال التغيير (محليًا فقط)
------------------------------*/
function changeStatus(id, status) {
  const app = applicationsData.find(a => a.id === id);
  app.status = status;
  updateRow(app);
}

function changeCalledStatus(id, called) {
  const app = applicationsData.find(a => a.id === id);
  app.called = called;
  updateRow(app);
}

function getStatusLabel(status) {
  if (status === 0) return "Waiting";
  if (status === 1) return "Accepted";
  return "Rejected";
}
</script>

</body>
</html>
