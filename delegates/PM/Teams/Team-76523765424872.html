<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="icon" href="../../../img/logo.png" type="image/png">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
  <link rel="stylesheet" href="https://cdn.datatables.net/1.13.5/css/jquery.dataTables.min.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.17.0/xlsx.full.min.js"></script>
  <script src="https://cdn.datatables.net/1.13.5/js/jquery.dataTables.min.js"></script>
  <link rel="stylesheet" href="css/applications.css">
  <title>X-Project</title>
  <style>
    @import url("https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600&display=swap");

    body {
      background-image: url('../../../img/qr/BG.png');
      font-family: "Poppins", sans-serif;
      margin: 0;
      padding: 0;
      color: #ffffff;
    }
    .container {
      padding: 20px;
      margin: auto;
      max-width: 1300px;
    }
    .search-bar {
      display: flex;
      justify-content: space-between;
      margin-top: 7px;
    }
    .search-bar input {
      padding: 8px;
      width: 200px;
    }
    .status-filter select {
      padding: 8px;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 20px;
      overflow-x: auto;
      display: block;
    }
    table th, table td {
      min-width: 100px;
      border: 1px solid #000;
      padding: 8px;
      text-align: center;
      font-size: 12px;
    }
    table th {
      background-color: #000;
      color: #ffffff;
    }
    .btn {
      padding: 8px 12px;
      color: white;
      border: none;
      cursor: pointer;
      margin: 2px 0;
      font-size: 12px;
    }
    .modal {
      display: none;
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: white;
      padding: 20px;
      border-radius: 5px;
      box-shadow: 0px 0px 10px gray;
      width: 90%;
      max-width: 400px;
    }
    .modal.active {
      display: block;
    }
    #teamFilter{
      margin-left: 300px;
      padding: 8px 12px;
      color: white;
      border: none;
      cursor: pointer;
      margin: 2px 0;
      font-size: 12px;
      background-color: rgba(249, 147, 37, 0.9);
      margin-left: 850px;
    }
    @media screen and (max-width: 768px) {
      .container {
        padding: 10px;
      }
      .search-bar {
        flex-direction: column;
        align-items: center;
      }
      .search-bar input {
        width: 100%;
        margin-bottom: 10px;
      }
      table {
        display: block;
        overflow-x: auto;
      }
      table th, table td {
        font-size: 10px;
        padding: 5px;
      }
      .btn {
        padding: 6px 10px;
        font-size: 10px;
      }
    }
  </style>
</head>
<body>

    
  <div class="container">
    <!-- Search bar -->
    <div class="search-bar">
        <input type="text" id="search" placeholder="Search by name or phone" style="padding: 8px; width: 200px;" oninput="searchApplications()">
      </div>
    
    <div class="filter-section">
      <label>حالة الفريق:</label>
      <input type="radio" id="status_busy" name="team_status" value="1" onclick="updateTeamStatus(1)">
      <label for="status_busy">مش فاضي</label>
      <input type="radio" id="status_free" name="team_status" value="0" onclick="updateTeamStatus(0)">
      <label for="status_free">أنا فاضي</label>
    </div>

    
    <label id="filterCount" style="font-weight: bold; font-size: 16px; display: block; text-align: center;">Total: 0</label>  

   
    <table id="applicationsTable">
      <thead>
        <tr>
          <th>Name</th>
          <th>Email</th>
          <th>Phone</th>
          <th>Faculty</th>
          <th>Level</th>
          <th>Strengths</th>
          <th>Weaknesses</th>
          <th>Team</th>
        </tr>
      </thead>
      <tbody>
        
      </tbody>
    </table>
  </div>

  <script>
    let applicationsData = [];
    let teamStatus = 1; 
    const teamId = 2; 

    async function fetchApplications() {
      try {
        const response = await fetch("https://x-project.co/public/api/delegate/all");
        const data = await response.json();

        
        applicationsData = data.data.filter(app => app.team_id === teamId);

        document.getElementById("filterCount").textContent = `Total: ${applicationsData.length}`;
        renderTable(applicationsData);
      } catch (error) {
        console.error("Error fetching applications:", error);
      }
    }

    function renderTable(applications) {
      const tableBody = document.querySelector("#applicationsTable tbody");
      tableBody.innerHTML = "";

      applications.forEach((app) => {
        const row = document.createElement("tr");
        row.innerHTML = `
          <td>${app.name}</td>
          <td>${app.email}</td>
          <td>${app.phone}</td>
          <td>${app.faculty}</td>
          <td>${app.level}</td>
          <td>${app.strengths}</td>
          <td>${app.weaknesses}</td>
          <td>${app.team_id ? app.team_id : "No Team"}</td>
        `;
        tableBody.appendChild(row);
      });
    }

    async function fetchTeamStatus() {
      try {
        const response = await fetch(`https://x-project.co/public/api/delegate/team-status/${teamId}`);
        const data = await response.json();

        teamStatus = data.status; 
        document.getElementById(`status_${teamStatus === 1 ? "busy" : "free"}`).checked = true;
      } catch (error) {
        console.error("Error fetching team status:", error);
      }
    }

    async function updateTeamStatus(newStatus) {
      try {
        const response = await fetch(`https://x-project.co/public/api/delegate/team-status/${teamId}`, {
          method: "PUT",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ status: newStatus })
        });

        if (!response.ok) throw new Error("Failed to update status");

        teamStatus = newStatus;
        console.log(`Team status updated to: ${teamStatus}`);
      } catch (error) {
        console.error("Error updating team status:", error);
      }
    }

    function searchApplications() {
      const searchText = document.getElementById("search").value.toLowerCase();
      const filteredData = applicationsData.filter((app) =>
        app.name.toLowerCase().includes(searchText) || app.phone.includes(searchText)
      );
      renderTable(filteredData);
    }

    document.addEventListener("DOMContentLoaded", () => {
      fetchApplications();
      fetchTeamStatus(); 
    });

  </script>

</body>
</html>
